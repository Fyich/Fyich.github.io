---
title: 事务与锁
date: 2025-06-01 23:18:49
categories:
  - 面经八股
tags:
  - 面经八股
  - 事务
  - 锁
banner_img: /img/post3.jpg
---
面试过程中遇到了这样的问题：事务在外锁在内会出现什么问题，锁在外事务在内又会出现什么问题

# 事务内嵌套锁

这种情况主要考虑，事务为长事务，当事务没有完成的时候，锁却到期了，这时候就会出现问题

因此比较简单的解决方式是使用Redisson中的分布式锁，并启用看门狗机制，进行自动的锁续期

# 锁内嵌套事务

主要考虑数据方面的问题，若操作之后没有进行事务提交，其他事务会读取到旧的值，出现数据问题

两种较为经典的场景

- 插入数据前检查唯一性：因事务未提交，其他线程查不到已插入但未提交的数据，导致重复插入
- 更新依赖查询结果：如库存扣减，查询后因事务未提交，其他线程读取到旧值，引发超卖
